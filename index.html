<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Calculator</title>
    <link rel="icon" href="C:/Users/atma9/OneDrive/Desktop/BHU GRADE CALCULATOR/sitefav.ico">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
</head>
<style>
    body {
        background-color: #F4F6FF;
        font-family: Arial, sans-serif;
    }
    h1 {
        color: #333;
        text-align: center;
    }
    h2 {
        color: #666;
        text-align: center;
    }
    hr {
        border: 2px solid #333;
        width: 90%;
        margin-bottom: 20px;  
        border-radius: 1px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .headline {
        padding: 10px;
        margin-right: 10px;
        margin-left: 10px;    
    }
    .personal-info, .subject-info, .subject-info2, .subject-info3,
    .subject-info4, .subject-info5, .subject-info6, .language, .ancillary {
        margin: 10px;
        padding: 10px;
    }
    select, input {
        margin: 5px;
        padding: 5px;
    }
    button {
        margin: 20px;
        padding: 10px 20px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    #result {
        margin: 20px;
        padding: 20px;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #result h3 {
        color: #333;
        margin-bottom: 15px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
    }

    #result p {
        margin: 8px 0;
        color: #666;
        line-height: 1.4;
    }

    #result p:last-child {
        font-weight: bold;
        color: #333;
        margin-top: 15px;
        border-top: 2px solid #eee;
        padding-top: 10px;
    }
    .ancillary {
    display: block;
}

.softskills {
    margin: 10px;
    padding: 10px;
    display: none;
}

#downloadBtn {
    margin: 20px;
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#downloadBtn:hover {
    background-color: #45a049;
}

</style>
<body>
    <div class="headline">
        <h1>BANARAS HINDU UNIVERSITY</h1>
        <h2>Grade Calculator</h2>
    </div>
    <hr>
    <form id="gradeForm">
        <div class="personal-info">
            <label for="Name">Enter your name:</label>
            <input type="text" id="Name" name="Name" required>
            <label for="faculty">Select faculty:</label>
            <select name="faculty" id="faculty" required>
                <!--<option value="SCIENCE">SCIENCE</option>-->
                <!--<option value="COMMERCE">COMMERCE</option>-->
                <option value="ARTS">ARTS</option>
                <option value="SOCIAL SCIENCES">SOCIAL SCIENCES</option>
             </select>
            <label for="semester">Select semester:</label>
            <select name="semester" id="semester" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                
            </select>
        </div>
        <br>
        <form class="subjectForm">
        <div class="subject-info">
            <label for="subject1">Subject 1:</label>
            <select name="subject-info1" id="subject1" required>
                <option value="MTB-101">MTB-101:CALCULUS</option>
                <option value="MTB-201">MTB-201:CALCULUS II</option>
                <option value="MTB-301">MTB 301:ALGEBRA-I</option>
            </select>
            <label for="subject1-marks">Enter marks:</label>
            <input type="number" id="subject1-marks" name="subject1-marks" required oninput="this.value = Math.abs(this.value)">
            
        </div>
        <br>
        <div class="subject-info2">
            <label for="subject2">Subject 2:</label>
            <select name="subject-info2" id="subject2" required>
                <option value="MTB-102">MTB-102:GEOMETRY</option>
                <option value="MTB-202">MTB-202:STATIC & DYNAMIC</option>
                <option value="MTB-302">MTB 302:DIFFERENTIAL EQUATIONS</option>
                
            </select>
            <label for="subject2-marks">Enter marks:</label>
            <input type="number" id="subject2-marks" name="subject2-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        <br>
        <div class="subject-info3">
            <label for="subject3">Subject 3:</label>
            <select name="subject-info3" id="subject3" required>
                <option value="STA-101">STA-101:STATISTICS</option>
                <option value="STA-201">STA-201:DESCRIPTIVE STATISTICS</option>
                <option value="STA-201">STA-301:STATISTICAL INFERENCE</option>
            </select>
            <label for="subject3-marks">Enter marks:</label>
            <input type="number" id="subject3-marks" name="subject3-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        <br>
        <div class="subject-info4">
            <label for="subject4">Subject 4:</label>
            <select name="subject-info4" id="subject4" required>
                <option value="STA-102">STA-102:PRACTICALS BASED ON COURSE NO. STB–101</option>
                <option value="STA-202">STA-202:PRACTICALS BASED ON COURSE NO. STB–201 </option>
                <option value="STA-302">STA-302:PRACTICALS BASED ON COURSE NO. STB–301</option>

            </select>
            <label for="subject4-marks">Enter marks:</label>
            <input type="number" id="subject4-marks" name="subject4-marks" required oninput="this.value = Math.abs(this.value)">    
        </div>
        <br>
        <div class="subject-info5">
            <label for="subject5">Subject 5:</label>
            <select name="subject-info5" id="subject5" required>
                <option value="ECB-101">ECB-101:MICROECONOMICS</option>
                <option value="ECB-201">ECB-201:TECHNIQUES OF ECONOMIC ANALYSIS</option>
                <option value="ECB-301">ECB-301: MONEY,BANKING AND FINANCIAL MARKET</option>

            </select>
            <label for="subject5-marks">Enter marks:</label>
            <input type="number" id="subject5-marks" name="subject5-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        <br>
        <div class="subject-info6">
            <label for="subject6">Subject 6:</label>
            <select name="subject-info6" id="subject6" required>
                <option value="ECB-102">ECB-102:MACROECONOMICS</option>
                <option value="ECB-202">ECB-202:HISTORY OF ECONOMIC THOUGHT</option>
                <option value="ECB-302">ECB-302:PUBLIC ECONOMICS</option>
                 
            </select>
            <label for="subject6-marks">Enter marks:</label>
            <input type="number" id="subject6-marks" name="subject6-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        <br>
        <div class="language">
            <label for="language">Language:</label>
            <select name="language" id="language" required>
                <option value="LANGUAGE">LANGUAGE</option>
            </select>
            <label for="language-marks">Enter marks:</label>
            <input type="number" id="language-marks" name="language-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        <br>
        <div class="ancillary">
            <label for="ancillary">Ancillary:</label>
            <select name="ancillary" id="ancillary">    
                <option value="ANCILLARY">ANCILLARY</option>  
            </select>
            <label for="ancillary-marks">Enter marks:</label>
            <input type="number" id="ancillary-marks" name="ancillary-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        <br>
        <div class="softskills">
            <label for="softskills">Softskills:</label>
            <select name="softskills" id="softskills">
                <option value="softskills">SOFTSKILLS</option>
            </select>
            <label for="softskills">Enter marks:</label>
            <input type="number" id="softskills-marks" name="softskills-marks" required oninput="this.value = Math.abs(this.value)">
        </div>
        </form>
        <br>
        <button type="button" onclick="calculateGrade()">Calculate Grade</button>
    </form>

    <div id="result"></div>
    <button id="downloadBtn" style="display: none;" onclick="downloadGradeCard()">Download Grade Card</button>

    <script>
    // Add these variables at the top of your script section, outside any function
    let globalSubjects = {};
    let globalGradePoints = {};
    let globalTotalCredits = 0;
    let globalCgpa = 0;
    let globalCredits = {};

    // Add getLetterGrade as a global function
    function getLetterGrade(gradePoints) {
        if (gradePoints === 10) return 'S';
        if (gradePoints === 9) return 'A';
        if (gradePoints === 8) return 'B';
        if (gradePoints === 7) return 'C';
        if (gradePoints === 6) return 'D';
        if (gradePoints === 5) return 'E';
        return 'F';
    }

    // Function to toggle ancillary section visibility
    function toggleAncillary() {
        const faculty = document.getElementById('faculty').value;
        const semester = parseInt(document.getElementById('semester').value);
        const ancillarySection = document.querySelector('.ancillary');
        const softskillsSection = document.querySelector('.softskills');
        
        // Hide ancillary for ARTS faculty
        if (faculty === "ARTS") {
            ancillarySection.style.display = 'none';
            // Show softskills for semester 3 or higher
            if (semester >= 3) {
                softskillsSection.style.display = 'block';
            } else {
                softskillsSection.style.display = 'none';
            }
        } else {
            ancillarySection.style.display = 'block';
            softskillsSection.style.display = 'none';
        }
    }

    // Add event listeners for both faculty and semester changes
    document.getElementById('faculty').addEventListener('change', toggleAncillary);
    document.getElementById('semester').addEventListener('change', toggleAncillary);

    function calculateGrade() {
        // Get personal info
        const name = document.getElementById('Name').value;
        const faculty = document.getElementById('faculty').value;
        const semester = document.getElementById('semester').value;
        
        // Validate personal info
        if (!name || !faculty || !semester) {
            alert('Please fill in all required fields');
            return;
        }

        // Get selected subjects and their marks
        const subjects = {
            subject1: {
                name: document.getElementById('subject1').options[document.getElementById('subject1').selectedIndex].text,
                marks: Number(document.getElementById('subject1-marks').value)
            },
            subject2: {
                name: document.getElementById('subject2').options[document.getElementById('subject2').selectedIndex].text,
                marks: Number(document.getElementById('subject2-marks').value)
            },
            subject3: {
                name: document.getElementById('subject3').options[document.getElementById('subject3').selectedIndex].text,
                marks: Number(document.getElementById('subject3-marks').value)
            },
            subject4: {
                name: document.getElementById('subject4').options[document.getElementById('subject4').selectedIndex].text,
                marks: Number(document.getElementById('subject4-marks').value)
            },
            subject5: {
                name: document.getElementById('subject5').options[document.getElementById('subject5').selectedIndex].text,
                marks: Number(document.getElementById('subject5-marks').value)
            },
            subject6: {
                name: document.getElementById('subject6').options[document.getElementById('subject6').selectedIndex].text,
                marks: Number(document.getElementById('subject6-marks').value)
            },
            language: {
                name: document.getElementById('language').options[document.getElementById('language').selectedIndex].text,
                marks: Number(document.getElementById('language-marks').value)
            }
        };

        // Add ancillary for SOCIAL SCIENCES faculty
        if (faculty === "SOCIAL SCIENCES") {
            subjects.ancillary = {
                name: "ANCILLARY",
                marks: Number(document.getElementById('ancillary-marks').value)
            };
        }

        // Only add softskills if faculty is ARTS and semester >= 3
        if (faculty === "ARTS" && parseInt(semester) >= 3) {
            subjects.softskills = {
                name: document.getElementById('softskills').options[document.getElementById('softskills').selectedIndex].text,
                marks: Number(document.getElementById('softskills-marks').value)
            };
        }

        // Validate marks
        for (let subject in subjects) {
            if (subjects[subject].marks < 0 || subjects[subject].marks > 100 || isNaN(subjects[subject].marks)) {
                alert(`Please enter valid marks between 0 and 100 for ${subjects[subject].name}`);
                return;
            }
        }

        // Define credits
        const credits = {
            subject1: 3,
            subject2: 3,
            subject3: 4,
            subject4: 2,
            subject5: 3,
            subject6: 3,
            language: 3
        };

        // Add credits based on faculty and semester
        if (faculty === "ARTS" && parseInt(semester) >= 3) {
            credits.softskills = 3;
        } else if (faculty === "SOCIAL SCIENCES") {
            credits.ancillary = 3;
        }

        // Store credits globally
        globalCredits = credits;

        // Calculate grade points
        const getGradePoints = (marks) => {
            if (marks >= 90) return 10;
            if (marks >= 80) return 9;
            if (marks >= 70) return 8;
            if (marks >= 60) return 7;
            if (marks >= 50) return 6;
            if (marks >= 40) return 5;
            return 0;
        };

        // Calculate grade points for each subject
        const gradePoints = {};
        for (let subject in subjects) {
            gradePoints[subject] = getGradePoints(subjects[subject].marks);
        }

        // Calculate total credits and grade points
        const totalCredits = Object.values(credits).reduce((sum, credit) => sum + credit, 0);
        let totalGradePoints = 0;
        for (let subject in subjects) {
            totalGradePoints += credits[subject] * gradePoints[subject];
        }

        const cgpa = (totalGradePoints / totalCredits).toFixed(2);

        // Create result HTML
        let resultHTML = `
            <h3>Results:</h3>
            <p>Name: ${name}</p>
            <p>Faculty: ${faculty}</p>
            <p>Semester: ${semester}</p>
        `;

        // Add subject results
        for (let subject in subjects) {
            resultHTML += `
                <p>${subjects[subject].name}: ${subjects[subject].marks} 
                   (Grade Points: ${gradePoints[subject]}, 
                    Grade: ${getLetterGrade(gradePoints[subject])}, 
                    Credits: ${credits[subject]})</p>
            `;
        }

        resultHTML += `
            <p>Total Credits: ${totalCredits}</p>
            <p>Total Grade Points: ${totalGradePoints}</p>
            <p>CGPA: ${cgpa}</p>
        `;

        // Create or update result div
        const resultDiv = document.getElementById('result') || document.createElement('div');
        resultDiv.id = 'result';
        resultDiv.innerHTML = resultHTML;
        
        // Append resultDiv if it doesn't exist in the document
        if (!document.getElementById('result')) {
            document.body.appendChild(resultDiv);
        }

        // Show download button after results are displayed
        const downloadBtn = document.getElementById('downloadBtn');
        downloadBtn.style.display = 'block';

        // Store values globally
        globalSubjects = subjects;
        globalGradePoints = gradePoints;
        globalTotalCredits = totalCredits;
        globalCgpa = cgpa;
    }

    function downloadGradeCard() {
        try {
            const name = document.getElementById('Name').value;
            const faculty = document.getElementById('faculty').value;
            const semester = document.getElementById('semester').value;

            // Define the document content with modern styling
            const docDefinition = {
                pageSize: 'A4',
                pageMargins: [40, 60, 40, 60],
                content: [
                    {
                        text: 'BANARAS HINDU UNIVERSITY',
                        style: 'header',
                        margin: [0, 0, 0, 5]
                    },
                    {
                        text: 'Grade Card',
                        style: 'subheader',
                        margin: [0, 0, 0, 20]
                    },
                    {
                        layout: 'lightHorizontalLines',
                        table: {
                            widths: ['auto', '*'],
                            body: [
                                ['Name', { text: name, bold: false }],
                                ['Faculty', { text: faculty, bold: false }],
                                ['Semester', { text: semester, bold: false }]
                            ]
                        },
                        margin: [0, 0, 0, 20]
                    },
                    {
                        text: 'Academic Performance',
                        style: 'subheader',
                        margin: [0, 0, 0, 10]
                    },
                    {
                        layout: {
                            hLineWidth: function(i, node) { return 0.5; },
                            vLineWidth: function(i, node) { return 0.5; },
                            hLineColor: function(i, node) { return '#aaa'; },
                            vLineColor: function(i, node) { return '#aaa'; },
                            paddingLeft: function(i, node) { return 8; },
                            paddingRight: function(i, node) { return 8; },
                            paddingTop: function(i, node) { return 8; },
                            paddingBottom: function(i, node) { return 8; }
                        },
                        table: {
                            headerRows: 1,
                            widths: ['*', 'auto', 'auto', 'auto', 'auto'],
                            body: [
                                [
                                    { text: 'Subject', style: 'tableHeader' },
                                    { text: 'Marks', style: 'tableHeader' },
                                    { text: 'Grade Points', style: 'tableHeader' },
                                    { text: 'Grade', style: 'tableHeader' },
                                    { text: 'Credits', style: 'tableHeader' }
                                ]
                            ]
                        }
                    }
                ],
                styles: {
                    header: {
                        fontSize: 20,
                        bold: true,
                        alignment: 'center',
                        color: '#2c3e50'
                    },
                    subheader: {
                        fontSize: 16,
                        bold: true,
                        alignment: 'center',
                        color: '#34495e'
                    },
                    tableHeader: {
                        bold: true,
                        fontSize: 12,
                        color: '#2c3e50',
                        fillColor: '#f8f9fa'
                    }
                },
                defaultStyle: {
                    fontSize: 11,
                    color: '#2c3e50'
                }
            };

            // Add subject details to the table
            const subjectRows = [];
            for (let subject in globalSubjects) {
                if (globalSubjects[subject].marks) {
                    subjectRows.push([
                        globalSubjects[subject].name,
                        globalSubjects[subject].marks.toString(),
                        globalGradePoints[subject].toString(),
                        getLetterGrade(globalGradePoints[subject]),
                        (subject in globalCredits ? globalCredits[subject].toString() : '')
                    ]);
                }
            }
            docDefinition.content[4].table.body.push(...subjectRows);

            // Add summary table
            docDefinition.content.push(
                { text: '\n' },
                {
                    layout: 'lightHorizontalLines',
                    table: {
                        widths: ['*', 'auto'],
                        body: [
                            ['Total Credits', { text: globalTotalCredits.toString(), alignment: 'right' }],
                            ['CGPA', { text: globalCgpa.toString(), alignment: 'right', bold: true }]
                        ]
                    },
                    margin: [0, 10, 0, 20]
                },
                {
                    text: `Generated on: ${new Date().toLocaleDateString()}`,
                    style: 'footer',
                    margin: [0, 20, 0, 0],
                    alignment: 'right',
                    fontSize: 9,
                    italics: true
                }
            );

            // Generate and download PDF
            pdfMake.createPdf(docDefinition).download(`${name}_GradeCard_Sem${semester}.pdf`);

        } catch (error) {
            console.error('Error in downloadGradeCard:', error);
            alert('Error generating PDF. Please make sure you calculate grades first.');
        }
    }
    </script>
</body>
</html>
